<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>System inspekcji paczek</title>
<style>
body { font-family: Arial; margin:0; padding:1rem; background:#f0f0f0; }
.container { display:flex; gap:10px; }
.camera-panel { flex:1; background:#fff; padding:10px; border-radius:8px; border:1px solid #ccc; text-align:center; }
.latest-img { max-height:50vh; max-width:90%; border:4px solid #ccc; border-radius:8px; transition:border 0.2s; }
.label-good { color:green; font-weight:bold; }
.label-bad { color:red; font-weight:bold; }
.img-border-good { border-color:green !important; }
.img-border-bad { border-color:red !important; }
.thumbs { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; }
.thumb { width:120px; cursor:pointer; border:1px solid #ccc; border-radius:6px; padding:4px; }
.thumb img { width:100%; height:auto; object-fit:contain; max-height:100px; }
</style>
</head>
<body>
<div class="container">
    <div class="camera-panel" id="panel-X1">
        <h2>Kamera X1</h2>
        <label><input type="checkbox" id="sound-toggle-X1" checked> Sygnał dźwiękowy</label><br>
        <img id="latest-X1" class="latest-img" src="" alt="Brak zdjęcia">
        <div id="label-X1">—</div>
        <h3>Ostatnie 10 wadliwych paczek</h3>
        <div class="thumbs" id="thumbs-X1"></div>
    </div>
    <div class="camera-panel" id="panel-Y1">
        <h2>Kamera Y1</h2>
        <label><input type="checkbox" id="sound-toggle-Y1" checked> Sygnał dźwiękowy</label><br>
        <img id="latest-Y1" class="latest-img" src="" alt="Brak zdjęcia">
        <div id="label-Y1">—</div>
        <h3>Ostatnie 10 wadliwych paczek</h3>
        <div class="thumbs" id="thumbs-Y1"></div>
    </div>
</div>

<audio id="beep-sound" src="/static/beep.mp3" preload="auto"></audio>

<script src="https://cdn.socket.io/4.5.1/socket.io.min.js"></script>
<script>
const socket = io();
const lastBadTimestamps = { X1:0, Y1:0 };
const soundToggles = {
    X1:()=>document.getElementById('sound-toggle-X1').checked,
    Y1:()=>document.getElementById('sound-toggle-Y1').checked
};
const badImages = { X1:[], Y1:[] };

function renderThumbs(cam){
    const thumbsEl=document.getElementById('thumbs-'+cam);
    thumbsEl.innerHTML="";
    badImages[cam].forEach((item,index)=>{
        const box=document.createElement("div");
        box.className="thumb";
        box.onclick=()=>showModal(cam,index);
        const img=document.createElement("img");
        img.src=item.url+"?t="+item.timestamp;
        img.alt=item.filename;
        box.appendChild(img);
        thumbsEl.appendChild(box);
    });
}

function updateLatest(cam,item){
    const latestImg=document.getElementById('latest-'+cam);
    const label=document.getElementById('label-'+cam);
    latestImg.src=item.url+"?t="+item.timestamp;
    label.textContent=item.category;
    label.classList.remove("label-good","label-bad");
    latestImg.classList.remove("img-border-good","img-border-bad");
    if(item.category.toLowerCase()==="good"){
        label.classList.add("label-good");
        latestImg.classList.add("img-border-good");
    } else {
        label.classList.add("label-bad");
        latestImg.classList.add("img-border-bad");
    }
}

socket.on("new_image", function(item){
    updateLatest(item.camera,item);
    if(item.category.toLowerCase()!=="good"){
        if(item.timestamp>lastBadTimestamps[item.camera]){
            lastBadTimestamps[item.camera]=item.timestamp;
            if(soundToggles[item.camera]()){
                const beep=document.getElementById("beep-sound");
                beep.currentTime=0;
                beep.play().catch(()=>{});
            }
        }
        badImages[item.camera].unshift(item);
        if(badImages[item.camera].length>10) badImages[item.camera].pop();
        renderThumbs(item.camera);
    }
});

// Modal obsługa (przykładowa)
let currentCam="", currentIndex=0;
const modal=document.createElement("div"); // możesz dodać swój modal tutaj
function showModal(cam,index){currentCam=cam;currentIndex=index;}
</script>
</body>
</html>
